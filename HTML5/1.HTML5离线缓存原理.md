### HTML5离线缓存原理
#### 1. 什么是离线应用程序？为什么要开发离线应用程序？
> 离线应用程序是将构成Web应用程序需要的资源文件，比如js文件，html,css文件等，缓存一份在本地。当服务器和互联网之间的连接断开时，也可以正常运行应用程序。为了让应用程序在离线状态也可以正常运行，开发了离线应用程序。

#### 2. 什么是本地缓存？本地缓存和网页缓存有什么区别？
> 本地缓存，即离线Web应用程序：当客户端本地与Web应用程序的服务器之间没有建立连接时，也能正常在客户端本地，使用该Web应用程序进行有关操作。
> 本地缓存和网页缓存之间的区别：
> 1. 本地缓存服务于整个应用程序；网页缓存服务于单个网页。
> 2. 本地缓存只缓存指定缓存的网页；任何网页都具有网页缓存。
> 3. 本地缓存是可靠的，可控制对哪些内容进行缓存，不对哪些内容进行缓存，还可用编程手段来控制缓存的更新，利于缓存对象的各种属性、状态和事件开发出更强大的离线应用程序；网页缓存是不安全不可靠的，因为我们不确定网站中到底缓存了哪些网页，以及网页上的哪些资源。

#### 3. 什么是`manifest`文件？怎样在`manifest`文件中指定哪些内容需要进行本地缓存，哪些内容不需要？
> `manifest`文件是一个简单文本文件，在该文件中以清单的形式列出了需要本地缓存或不需要缓存的文件的名称和对应路径。可以为每个页面指定一个`manifest`文件，也可以对整个Web应用程序制定一个总的`manifest`文件。
> 在`manifest`文件中，第一行必须是`"CACHE MANIFEST"`文字，用来将该文件的作用告诉浏览器，即对本地缓存中的资源文件进行具体设置。当真正运行或者测试离线Web应用程序时，需要让服务器支持`text/cache-manifest`这个`MIME`类型。
> 指定资源文件时可分为三类（均为可选，若没指定，默认`CACHE`）：
> 1. `CACHE`：指定需要被缓存在本地的资源文件。
> 2. `NETWORK`：显式指定不进行本地缓存的资源文件。
> 3. `FALLBACK`：每行中指定两个资源文件。第一个为能够在线访问时使用的资源文件，第二个为不能在线访问时使用的备用资源文件。

#### 4. 使用本地缓存时浏览器与服务器的交互过程？本地资源如何更新？

> 比如一个`http:/Lulingniu`网站，以`index .html`为主页，该主页使用`index .manifest`文件为`manifest`文件，在该文件中请求本地缓存`index.html.hello.js. hellol jpg. hello2.jpg`这几个
资源文件。首次访`http:/Lulingniu`网站时， 它们的交互过程如下所示。
1)浏览器请求访问`http:/Lingniu`.
2)服务器返回`index.html`网页。
3)浏览器解析`index.html`网页，请求页面上所有资源文件，包括HTML文件、图像文件、CSS文件、JavaScript脚本文件，以及manifest文件。
4)服务器返回所有资源文件。
5)浏览器处理manifest文件，请求manifest中 所有要求本地缓存的文件，包括`index.html`页面本身，即使刚才已经请求过这些文件。如果你要求本地缓存所有文件，这将是一个比较大的重复的请求过程。
6)服务器返回所有要求本地缓存的文件。
7)浏览器对本地缓存进行更新，存入包括页面本身在内的所有要求本地缓存的资源文
件，并且触发一个事件，通知本地缓存被更新。

> 现在浏览器已经把本地文件更新完毕。如果再次打开浏览器访问`http:/Lulingniu`网站，而且`manifest`文件没有被修改过，它们的交互过程会如下所示。
1)浏览器再次请求访向`http:/Lulingniu`。
2)浏览器发现这个页面被本地缓存，于是使用本地缓存中`index.html`页面。
3)浏览器解析`index.html`页面，使用所有本地缓存中的资源文件。
4)浏览器向服务器请求`manifest`文件。
5)服务器返回一个304代码，通知浏览器`manifest`没有发生变化。
只要页面上的资源文件被本地缓存过，下次浏览器打开这个页面时，总是先使用本地缓
存中的资源，然后请求`manifest`文件。

> 如果再次打开浏览器时`manifest`文件已经被更新过了，那么浏览器与服务器之间的交互过程如下所示。
1)浏览器再次请求访问`http:/Lulingniu`。
2)浏览器发现这个页面被本地缓存，于是使用本地缓存中`index.html`页面。
3)浏览器解析`index.html`页面，使用所有本地缓存中的资源文件。
4)浏览器向服务器请求`manifest`文件。
5)服务器返回更新过的`manifest`文件。
6)浏览器处理`manifest`文件，发现该文件已被更新，于是请求所有要求进行本地缓存的资源文件，包括`index.html`页面本身。
7)浏览器返回要求进行本地缓存的资源文件。
8)浏览器对本地缓存进行更新，存入所有新的资源文件。并且触发一个事件，通知本
地缓存被更新。

*注意：即使资源文件被修改过，上边第三条已经装入的资源文件是不会发生变化的。只有重新打开这个页面才会使用更新过后的资源文件*

#### 5. `applicationCache`对象及其更新本地缓存的方法？

> `applicationCache`对象代表了本地缓存，可用来通知用户本地缓存中已经被更新，也允许用户手动更新本地缓存。当浏览器对本地缓存进行更新装入新的资源文件时，会触发`applicationCache`对象的`updateReady`事件，通知本地缓存已被更新。另外，你可以通过`applicationCache`的`swapCache`方法来控制如何进行本地缓存的更新及更新的时机。
```
applicationCache.onUpdateReady = function () {
  alert('本地缓存已经被更新，您可刷新页面来得到本程序的最新版本~');
}
```